<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="assets/favicon.ico" />
  <meta name="description" content="Welcome to Neko Charvanni’s world of romance, mythology, and magic." />
  <meta name="keywords" content="LGBTQ+, romance, fiction, Neko Charvanni, fantasy stories, vampire love, interactive fiction" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Neko Charvanni - Interactive Romance Stories</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300..700;1,300..700&family=Cinzel+Decorative:wght@400;700;900&display=swap" rel="stylesheet">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --primary-gold: #FFD700;
      --deep-purple: #4A1A4A;
      --rose-gold: #E8B4B8;
      --dark-chocolate: #3E2C1C;
      --matcha-green: #A3C293;
      --romantic-red: #8B0000;
      --soft-cream: #FFF8DC;
    }

    body {
      font-family: 'Cormorant Garamond', serif;
      background: linear-gradient(135deg, var(--deep-purple), #2A0A2A, #1A051A);
      color: var(--soft-cream);
      min-height: 100vh;
      line-height: 1.6;
    }

    /* Header */
    .header {
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      padding: 1rem 0;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      border-bottom: 2px solid var(--primary-gold);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2rem;
    }

    .logo {
      font-family: 'Cinzel Decorative', serif;
      font-size: 2rem;
      color: var(--primary-gold);
      text-decoration: none;
      font-weight: 700;
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 2rem;
    }

    .nav-links a {
      color: var(--soft-cream);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
    }

    .nav-links a:hover {
      color: var(--primary-gold);
    }

    .user-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--rose-gold), var(--romantic-red));
      color: white;
    }

    .btn-secondary {
      background: transparent;
      border: 2px solid var(--primary-gold);
      color: var(--primary-gold);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    /* Main Content */
    .main-content {
      margin-top: 80px;
      padding: 2rem;
    }

    .hero {
      text-align: center;
      padding: 4rem 0;
      background: radial-gradient(circle at center, rgba(255,215,0,0.1), transparent);
    }

    .hero h1 {
      font-family: 'Cinzel Decorative', serif;
      font-size: 3.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(45deg, var(--primary-gold), var(--rose-gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 1.3rem;
      margin-bottom: 2rem;
      opacity: 0.9;
    }

    /* Story Selection */
    .story-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 0;
    }

    .story-card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 2rem;
      border: 1px solid rgba(255,215,0,0.3);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
    }

    .story-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(255,215,0,0.2);
    }

    .story-card h3 {
      font-family: 'Cinzel Decorative', serif;
      color: var(--primary-gold);
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }

    .story-card p {
      margin-bottom: 1.5rem;
      opacity: 0.8;
    }

    .story-progress {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      height: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--matcha-green), var(--primary-gold));
      border-radius: 10px;
      transition: width 0.3s;
    }

    /* Chapter Reader */
    .chapter-reader {
      display: none;
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 3rem;
      border: 1px solid rgba(255,215,0,0.2);
    }

    .chapter-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .chapter-title {
      font-family: 'Cinzel Decorative', serif;
      color: var(--primary-gold);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .chapter-subtitle {
      opacity: 0.8;
      font-size: 1.1rem;
    }

    .media-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .video-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 0 auto 2rem;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      background: rgba(0,0,0,0.5);
    }

    .story-video {
      width: 100%;
      height: auto;
      display: block;
    }

    .chapter-text {
      background: rgba(0,0,0,0.2);
      padding: 2rem;
      border-radius: 15px;
      margin: 2rem 0;
      line-height: 1.8;
      font-size: 1.1rem;
    }

    /* Avatar Customizer */
    .avatar-section {
      display: none;
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    .avatar-customizer {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(255,215,0,0.2);
    }

    .avatar-preview {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto 2rem;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid var(--primary-gold);
      background: linear-gradient(135deg, var(--rose-gold), var(--romantic-red));
    }

    .customization-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 2rem;
    }

    .customization-group {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 10px;
    }

    .customization-group label {
      display: block;
      color: var(--primary-gold);
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .customization-group select,
    .customization-group input[type="range"],
    .customization-group input[type="color"] {
      width: 100%;
      padding: 0.5rem;
      border: none;
      border-radius: 5px;
      background: rgba(255,255,255,0.1);
      color: var(--soft-cream);
    }

    /* Voice Controls */
    .voice-controls {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 10px;
      margin: 1rem 0;
    }

    .voice-settings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    /* Payment Modal */
    .payment-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .payment-content {
      background: linear-gradient(135deg, var(--deep-purple), #2A0A2A);
      padding: 3rem;
      border-radius: 20px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      border: 2px solid var(--primary-gold);
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      position: relative;
    }

    .payment-content h2 {
      font-family: 'Cinzel Decorative', serif;
      color: var(--primary-gold);
      margin-bottom: 1rem;
    }

    .pricing-options {
      display: grid;
      gap: 1rem;
      margin: 2rem 0;
    }

    .pricing-option {
      background: rgba(255,255,255,0.1);
      padding: 1.5rem;
      border-radius: 10px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
    }

    .pricing-option:hover,
    .pricing-option.selected {
      border-color: var(--primary-gold);
      background: rgba(255,215,0,0.1);
    }

    .pricing-option h3 {
      color: var(--primary-gold);
      margin-bottom: 0.5rem;
    }

    .pricing-option .price {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--rose-gold);
      margin-bottom: 0.5rem;
    }

    .close-modal {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      background: none;
      border: none;
      color: var(--primary-gold);
      font-size: 2rem;
      cursor: pointer;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .nav-links {
        flex-direction: column;
        gap: 1rem;
      }

      .hero h1 {
        font-size: 2.5rem;
      }

      .story-grid {
        grid-template-columns: 1fr;
        padding: 1rem;
      }

      .chapter-reader,
      .avatar-customizer {
        margin: 1rem;
        padding: 1.5rem;
      }

      .media-controls {
        flex-direction: column;
      }

      .customization-panel {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="#" class="logo">Neko Charvanni</a>
      <nav>
        <ul class="nav-links">
          <li><a href="#" onclick="showSection('home')">Home</a></li>
          <li><a href="#" onclick="showSection('stories')">Stories</a></li>
          <li><a href="#" onclick="showSection('avatar')">Avatar</a></li>
          <li><a href="#" onclick="showSection('library')">My Library</a></li>
        </ul>
      </nav>
      <div class="user-controls">
        <button class="btn btn-secondary" onclick="showSection('avatar')">Customize Avatar</button>
        <button class="btn btn-primary" onclick="showPaymentModal()">Unlock Premium</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Home Section -->
    <section id="home-section" class="section">
      <div class="hero">
        <h1 class="fade-in">Welcome to Romance</h1>
        <p class="fade-in">Immerse yourself in illustrated stories with voice narration and personalized avatars</p>
        <button class="btn btn-primary pulse" onclick="showSection('stories')">Start Your Journey</button>
      </div>

      <div class="story-grid fade-in">
        <div class="story-card" onclick="selectStory('chocolate-matcha')">
          <h3>Chocolate & Matcha</h3>
          <p>A sensual tale of tradition and passion in modern Osaka, where a master tea ceremony host meets his match.</p>
          <div class="story-progress">
            <div class="progress-bar" style="width: 60%"></div>
          </div>
          <p><strong>3/5 chapters unlocked</strong></p>
        </div>

        <div class="story-card" onclick="selectStory('tiger-eyes')">
          <h3>Her Tiger Eyes</h3>
          <p>A mystical romance where ancient magic meets modern love in the shadows of forgotten temples.</p>
          <div class="story-progress">
            <div class="progress-bar" style="width: 40%"></div>
          </div>
          <p><strong>2/6 chapters unlocked</strong></p>
        </div>

        <div class="story-card" onclick="selectStory('immortal-angel')">
          <h3>Immortal Angel</h3>
          <p>A paranormal romance spanning centuries, where love transcends death and time itself.</p>
          <div class="story-progress">
            <div class="progress-bar" style="width: 20%"></div>
          </div>
          <p><strong>1/8 chapters unlocked</strong></p>
        </div>
      </div>
    </section>

    <!-- Stories Section -->
    <section id="stories-section" class="section" style="display: none;">
      <div class="chapter-reader">
        <div class="chapter-header">
          <h2 class="chapter-title" id="chapter-title">Select a Story</h2>
          <p class="chapter-subtitle" id="chapter-subtitle">Choose from our collection</p>
        </div>

        <div class="media-controls">
          <button class="btn btn-secondary" onclick="toggleVideoMode()">
            <span id="video-toggle">📹 Show Video</span>
          </button>
          <button class="btn btn-secondary" onclick="toggleTextReader()">
            <span id="reader-toggle">🔊 Start Reading</span>
          </button>
          <button class="btn btn-secondary" onclick="showSection('avatar')">👤 Customize Avatar</button>
        </div>

        <div class="video-container" id="video-container" style="display: none;">
          <canvas class="story-video" id="story-canvas" width="600" height="400"></canvas>
        </div>

        <div class="voice-controls">
          <h4>Voice Settings</h4>
          <div class="voice-settings">
            <div>
              <label>Voice:</label>
              <select id="voice-select">
                <option value="female-1">Sarah (Sultry)</option>
                <option value="female-2">Emma (Romantic)</option>
                <option value="male-1">James (Deep)</option>
                <option value="male-2">Alex (Warm)</option>
              </select>
            </div>
            <div>
              <label>Speed:</label>
              <input type="range" id="voice-speed" min="0.5" max="2" step="0.1" value="1">
            </div>
            <div>
              <label>Pitch:</label>
              <input type="range" id="voice-pitch" min="0.5" max="2" step="0.1" value="1">
            </div>
          </div>
        </div>

        <div class="chapter-text" id="chapter-content">
          <p>Select a story to begin your romantic journey...</p>
        </div>

        <div class="media-controls">
          <button class="btn btn-secondary" onclick="previousChapter()">← Previous</button>
          <button class="btn btn-primary" onclick="nextChapter()">Next Chapter →</button>
        </div>
      </div>
    </section>

    <!-- Avatar Section -->
    <section id="avatar-section" class="section avatar-section" style="display: none;">
      <div class="avatar-customizer">
        <h2>Customize Your Avatar</h2>
        <p>Create your perfect romantic character</p>
        
        <div class="avatar-preview">
          <canvas id="avatar-canvas" width="200" height="200"></canvas>
        </div>

        <div class="customization-panel">
          <div class="customization-group">
            <label>Skin Tone</label>
            <input type="color" id="skin-color" value="#F2D3C4">
          </div>
          
          <div class="customization-group">
            <label>Hair Style</label>
            <select id="hair-style">
              <option value="long">Long & Flowing</option>
              <option value="short">Short & Chic</option>
              <option value="curly">Curly & Wild</option>
              <option value="braided">Elegant Braids</option>
            </select>
          </div>
          
          <div class="customization-group">
            <label>Hair Color</label>
            <input type="color" id="hair-color" value="#8B4513">
          </div>
          
          <div class="customization-group">
            <label>Eye Shape</label>
            <select id="eye-shape">
              <option value="almond">Almond</option>
              <option value="round">Round</option>
              <option value="hooded">Hooded</option>
              <option value="upturned">Upturned</option>
            </select>
          </div>
          
          <div class="customization-group">
            <label>Eye Color</label>
            <input type="color" id="eye-color" value="#8B4513">
          </div>
          
          <div class="customization-group">
            <label>Outfit Style</label>
            <select id="outfit-style">
              <option value="casual">Casual</option>
              <option value="elegant">Elegant</option>
              <option value="traditional">Traditional</option>
              <option value="modern">Modern</option>
            </select>
          </div>
        </div>

        <div class="media-controls">
          <button class="btn btn-secondary" onclick="resetAvatar()">Reset</button>
          <button class="btn btn-primary" onclick="saveAvatar()">Save Avatar</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Payment Modal -->
  <div class="payment-modal" id="payment-modal">
    <div class="payment-content">
      <button class="close-modal" onclick="hidePaymentModal()">&times;</button>
      <h2>Unlock Premium Stories</h2>
      <p>Continue your romantic journey with full access to all chapters</p>
      
      <div class="pricing-options">
        <div class="pricing-option" onclick="selectPricing('single')" data-price="price_single_story">
          <h3>Single Story</h3>
          <p class="price">$4.99</p>
          <p>Unlock all chapters of one story</p>
        </div>
        
        <div class="pricing-option selected" onclick="selectPricing('all')" data-price="price_all_stories">
          <h3>All Stories Access</h3>
          <p class="price">$12.99</p>
          <p>Unlock all current and future stories</p>
        </div>
        
        <div class="pricing-option" onclick="selectPricing('monthly')" data-price="price_monthly">
          <h3>Monthly Subscription</h3>
          <p class="price">$7.99/month</p>
          <p>Monthly access + exclusive content</p>
        </div>
      </div>
      
      <button class="btn btn-primary" onclick="processPurchase()">Purchase Now</button>
    </div>
  </div>

  <script>
    // Global state
    let currentStory = null;
    let currentChapter = 1;
    let maxFreeChapters = 3;
    let isReading = false;
    let speechSynthesis = window.speechSynthesis;
    let currentUtterance = null;
    let selectedPricing = 'all';

    // Story data
    const stories = {
      'chocolate-matcha': {
        title: 'Chocolate & Matcha',
        chapters: 5,
        content: {
          1: {
            title: 'Chapter 1: Osaka Tea Garden',
            text: `In the garden following the path of arranged onyx marble stepping-stones, past the water basin and near cherry blossom trees in tranquil bloom, Kazuhiko Wakahisa sat on the stone bench sipping green tea he prepared. His eyes wandered past the shrubberies arranged simplistically around the garden to the jade fountain. Two intricately sculptured jade dragons twisted around a miniature jade Mount Fuji. Crystal clear water serenely flowed through their fangs, cascading down Mount Fuji until the water trickled into the base.`,
            video: 'chocolate-matcha'
          },
          2: {
            title: 'Chapter 2: The Encounter',
            text: `"Haha, mother," he yelled at Charlene and humiliated Ryuku. "Not to mention his affair with Hanako Love." Charlene briefly listened to the conversation Natsumi was having with their mother. Natsumi was still attempting to sway their mother's decision to renounce their attendance at the ceremony.`,
            video: 'chocolate-matcha'
          },
          3: {
            title: 'Chapter 3: Rising Tensions',
            text: `The ceremony was set to begin, and Kazuhiko found himself more nervous than he had been in years. The weight of tradition and expectation pressed down on him as he prepared the sacred tea. Little did he know that this ceremony would change everything.`,
            video: 'chocolate-matcha'
          },
          4: {
            title: 'Chapter 4: Forbidden Desires',
            text: `As the tea ceremony progressed, Kazuhiko couldn't shake the memory of the mysterious woman who had thrown her drink at him. Her fierce eyes haunted his thoughts, stirring feelings he had never experienced before.`,
            video: 'chocolate-matcha'
          },
          5: {
            title: 'Chapter 5: Hearts Unveiled',
            text: `The final confrontation between Kazuhiko and Charlene would determine whether their pride would keep them apart, or if love could bridge the gap between their different worlds.`,
            video: 'chocolate-matcha'
          }
        }
      },
      'tiger-eyes': {
        title: 'Her Tiger Eyes',
        chapters: 6,
        content: {
          1: {
            title: 'Chapter 1: The Ancient Library',
            text: `The old library stood like a sentinel against time, its weathered stones holding secrets that predated the modern world. Amara traced her fingers along the ancient texts, feeling the mystical energy that seemed to pulse from within the leather-bound volumes.`,
            video: 'tiger-eyes'
          },
          2: {
            title: 'Chapter 2: Awakening Powers',
            text: `As Amara delved deeper into the forbidden texts, she began to understand the truth about her heritage. The tiger eyes that had always made her different were not a curse, but a gift that connected her to an ancient magical lineage.`,
            video: 'tiger-eyes'
          }
        }
      },
      'immortal-angel': {
        title: 'Immortal Angel',
        chapters: 8,
        content: {
          1: {
            title: 'Chapter 1: The Awakening',
            text: `For centuries, she had walked among mortals, her true nature hidden behind the facade of humanity. But tonight, everything would change when she met the one person who could see through her immortal disguise and touch her eternal soul.`,
            video: 'immortal-angel'
          }
        }
      }
    };

    // Section management
    function showSection(sectionName) {
      // Hide all sections
      document.querySelectorAll('.section').forEach(section => {
        section.style.display = 'none';
      });
      
      // Show selected section
      const targetSection = document.getElementById(sectionName + '-section');
      if (targetSection) {
        targetSection.style.display = 'block';
        targetSection.classList.add('fade-in');
        
        // Show chapter reader when stories section is opened
        if (sectionName === 'stories') {
          document.querySelector('.chapter-reader').style.display = 'block';
        }
      }
    }

    // Story selection
    function selectStory(storyId) {
      currentStory = storyId;
      currentChapter = 1;
      showSection('stories');
      loadChapter();
    }

    // Chapter loading
    function loadChapter() {
      if (!currentStory || !stories[currentStory]) return;
      
      const story = stories[currentStory];
      const chapter = story.content[currentChapter];
      
      if (!chapter) {
        document.getElementById('chapter-content').innerHTML = '<p>Chapter not available</p>';
        return;
      }
      
      document.getElementById('chapter-title').textContent = story.title;
      document.getElementById('chapter-subtitle').textContent = chapter.title;
      document.getElementById('chapter-content').innerHTML = `<p>${chapter.text}</p>`;
      
      // Generate video for chapter
      generateChapterVideo(currentStory, chapter);
      
      saveProgress();
    }

    // Generate video using canvas animation
    function generateChapterVideo(storyId, chapterData) {
      const canvas = document.getElementById('story-canvas');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      
      let frame = 0;
      function animate() {
        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Create background based on story theme
        createStoryBackground(ctx, canvas, storyId, frame);
        
        // Add text overlay
        if (frame > 60) { // Show text after 2 seconds
          addTextOverlay(ctx, canvas, chapterData.title, frame - 60);
        }
        
        frame++;
        if (frame < 300) { // 10 seconds at 30fps
          requestAnimationFrame(animate);
        }
      }
      
      animate();
    }

    // Create story-themed backgrounds
    function createStoryBackground(ctx, canvas, storyTheme, frame) {
      switch (storyTheme) {
        case 'chocolate-matcha':
          drawTeaGardenScene(ctx, canvas, frame);
          break;
        case 'tiger-eyes':
          drawMysticalLibraryScene(ctx, canvas, frame);
          break;
        case 'immortal-angel':
          drawGothicMansionScene(ctx, canvas, frame);
          break;
        default:
          drawRomanticScene(ctx, canvas, frame);
      }
    }

    // Tea garden scene for Chocolate & Matcha
    function drawTeaGardenScene(ctx, canvas, frame) {
      // Gradient sky
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#87CEEB');
      gradient.addColorStop(1, '#F0E68C');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Animated falling petals
      ctx.fillStyle = '#FFB6C1';
      for (let i = 0; i < 15; i++) {
        const x = (frame * 2 + i * 40) % canvas.width;
        const y = (frame * 3 + i * 30) % canvas.height;
        ctx.beginPath();
        ctx.arc(x, y, 6, 0, Math.PI * 2);
        ctx.fill();
      }
      
      // Tea fountain
      ctx.fillStyle = '#696969';
      ctx.fillRect(canvas.width/2 - 25, canvas.height - 80, 50, 20);
      
      // Water animation
      ctx.fillStyle = '#87CEEB';
      const waterHeight = Math.sin(frame * 0.1) * 5 + 10;
      ctx.fillRect(canvas.width/2 - 20, canvas.height - 80 - waterHeight, 40, waterHeight);
    }

    // Mystical library scene for Tiger Eyes
    function drawMysticalLibraryScene(ctx, canvas, frame) {
      // Dark mystical background
      const gradient = ctx.createRadialGradient(
        canvas.width / 2, canvas.height / 2, 0,
        canvas.width / 2, canvas.height / 2, canvas.width
      );
      gradient.addColorStop(0, '#4B0082');
      gradient.addColorStop(1, '#000000');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Floating magical sparkles
      ctx.fillStyle = '#FFD700';
      for (let i = 0; i < 20; i++) {
        const x = Math.sin(frame * 0.02 + i) * 100 + canvas.width / 2;
        const y = Math.cos(frame * 0.01 + i) * 75 + canvas.height / 2;
        const size = Math.sin(frame * 0.05 + i) * 3 + 2;
        ctx.beginPath();
        ctx.arc(x, y, size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // Gothic mansion scene for Immortal Angel
    function drawGothicMansionScene(ctx, canvas, frame) {
      // Dark Gothic background
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#1a1a2e');
      gradient.addColorStop(1, '#16213e');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Moon
      ctx.fillStyle = '#F5F5DC';
      ctx.beginPath();
      ctx.arc(canvas.width - 80, 60, 30, 0, Math.PI * 2);
      ctx.fill();
      
      // Floating ethereal spirits
      ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
      for (let i = 0; i < 10; i++) {
        const x = Math.sin(frame * 0.01 + i * 0.5) * 150 + canvas.width / 2;
        const y = Math.cos(frame * 0.015 + i * 0.3) * 100 + canvas.height / 3;
        const size = Math.sin(frame * 0.03 + i) * 5 + 8;
        ctx.globalAlpha = 0.6;
        ctx.beginPath();
        ctx.arc(x, y, size, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    // Default romantic scene
    function drawRomanticScene(ctx, canvas, frame) {
      // Romantic sunset background
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#FF6B6B');
      gradient.addColorStop(0.5, '#FFE66D');
      gradient.addColorStop(1, '#FF8E53');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Floating hearts
      ctx.fillStyle = '#FF69B4';
      for (let i = 0; i < 8; i++) {
        const x = (frame + i * 75) % canvas.width;
        const y = Math.sin(frame * 0.01 + i) * 25 + canvas.height / 2;
        drawHeart(ctx, x, y, 10);
      }
    }

    // Draw heart shape
    function drawHeart(ctx, x, y, size) {
      ctx.beginPath();
      ctx.moveTo(x, y + size / 4);
      ctx.bezierCurveTo(x, y, x - size / 2, y, x - size / 2, y + size / 4);
      ctx.bezierCurveTo(x - size / 2, y + size / 2, x, y + size, x, y + size);
      ctx.bezierCurveTo(x, y + size, x + size / 2, y + size / 2, x + size / 2, y + size / 4);
      ctx.bezierCurveTo(x + size / 2, y, x, y, x, y + size / 4);
      ctx.fill();
    }

    // Add text overlay to canvas
    function addTextOverlay(ctx, canvas, text, frame) {
      ctx.font = '24px Cinzel Decorative, serif';
      ctx.fillStyle = 'white';
      ctx.shadowColor = 'rgba(0,0,0,0.8)';
      ctx.shadowBlur = 10;
      ctx.textAlign = 'center';
      
      // Typewriter effect
      const charsToShow = Math.floor(frame / 3);
      const visibleText = text.substring(0, Math.max(0, charsToShow));
      
      if (visibleText) {
        ctx.fillText(visibleText, canvas.width / 2, canvas.height / 2);
      }
      
      ctx.shadowBlur = 0;
    }

    // Chapter navigation
    function nextChapter() {
      if (!currentStory) return;
      
      const nextChap = currentChapter + 1;
      
      // Check if user needs to pay
      if (nextChap > maxFreeChapters && !isPremiumUser()) {
        showPaymentModal();
        return;
      }
      
      if (nextChap <= stories[currentStory].chapters) {
        currentChapter = nextChap;
        loadChapter();
      }
    }

    function previousChapter() {
      if (currentChapter > 1) {
        currentChapter--;
        loadChapter();
      }
    }

    // Media controls
    function toggleVideoMode() {
      const container = document.getElementById('video-container');
      const toggle = document.getElementById('video-toggle');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        toggle.textContent = '📹 Hide Video';
      } else {
        container.style.display = 'none';
        toggle.textContent = '📹 Show Video';
      }
    }

    function toggleTextReader() {
      const toggle = document.getElementById('reader-toggle');
      
      if (isReading) {
        stopReading();
        toggle.textContent = '🔊 Start Reading';
        isReading = false;
      } else {
        startReading();
        toggle.textContent = '⏸️ Stop Reading';
        isReading = true;
      }
    }

    function startReading() {
      const text = document.getElementById('chapter-content').textContent;
      if (speechSynthesis && text) {
        // Cancel any existing speech
        speechSynthesis.cancel();
        
        currentUtterance = new SpeechSynthesisUtterance(text);
        
        // Apply voice settings
        const speed = document.getElementById('voice-speed').value;
        const pitch = document.getElementById('voice-pitch').value;
        
        currentUtterance.rate = parseFloat(speed);
        currentUtterance.pitch = parseFloat(pitch);
        
        // Set voice based on selection
        const voices = speechSynthesis.getVoices();
        const voiceSelect = document.getElementById('voice-select').value;
        
        if (voiceSelect.includes('female')) {
          const femaleVoices = voices.filter(voice => 
            voice.name.toLowerCase().includes('female') || 
            voice.name.toLowerCase().includes('samantha') ||
            voice.name.toLowerCase().includes('karen') ||
            voice.name.toLowerCase().includes('susan')
          );
          if (femaleVoices.length > 0) {
            currentUtterance.voice = femaleVoices[0];
          }
        } else if (voiceSelect.includes('male')) {
          const maleVoices = voices.filter(voice => 
            voice.name.toLowerCase().includes('male') || 
            voice.name.toLowerCase().includes('alex') ||
            voice.name.toLowerCase().includes('daniel')
          );
          if (maleVoices.length > 0) {
            currentUtterance.voice = maleVoices[0];
          }
        }
        
        currentUtterance.onend = () => {
          isReading = false;
          document.getElementById('reader-toggle').textContent = '🔊 Start Reading';
        };
        
        speechSynthesis.speak(currentUtterance);
      }
    }

    function stopReading() {
      if (speechSynthesis) {
        speechSynthesis.cancel();
      }
    }

    // Avatar system
    function initializeAvatar() {
      const canvas = document.getElementById('avatar-canvas');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      canvas.width = 200;
      canvas.height = 200;
      
      drawAvatar();
      
      // Add event listeners for customization
      const elements = ['skin-color', 'hair-style', 'hair-color', 'eye-shape', 'eye-color', 'outfit-style'];
      elements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener('change', drawAvatar);
        }
      });
    }

    function drawAvatar() {
      const canvas = document.getElementById('avatar-canvas');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Get current settings
      const skinColor = document.getElementById('skin-color')?.value || '#F2D3C4';
      const hairStyle = document.getElementById('hair-style')?.value || 'long';
      const hairColor = document.getElementById('hair-color')?.value || '#8B4513';
      const eyeShape = document.getElementById('eye-shape')?.value || 'almond';
      const eyeColor = document.getElementById('eye-color')?.value || '#8B4513';
      const outfitStyle = document.getElementById('outfit-style')?.value || 'casual';
      
      // Draw face
      ctx.fillStyle = skinColor;
      ctx.beginPath();
      ctx.arc(100, 100, 80, 0, Math.PI * 2);
      ctx.fill();
      
      // Draw hair based on style
      ctx.fillStyle = hairColor;
      switch(hairStyle) {
        case 'long':
          ctx.beginPath();
          ctx.ellipse(100, 60, 90, 40, 0, 0, Math.PI * 2);
          ctx.fill();
          ctx.beginPath();
          ctx.ellipse(100, 120, 85, 60, 0, 0, Math.PI * 2);
          ctx.fill();
          break;
        case 'short':
          ctx.beginPath();
          ctx.ellipse(100, 70, 85, 35, 0, 0, Math.PI * 2);
          ctx.fill();
          break;
        case 'curly':
          for(let i = 0; i < 8; i++) {
            const angle = (i * Math.PI * 2) / 8;
            const x = 100 + Math.cos(angle) * 70;
            const y = 70 + Math.sin(angle) * 30;
            ctx.beginPath();
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.fill();
          }
          break;
        case 'braided':
          ctx.beginPath();
          ctx.ellipse(100, 60, 80, 30, 0, 0, Math.PI * 2);
          ctx.fill();
          break;
      }
      
      // Draw eyes
      ctx.fillStyle = eyeColor;
      switch(eyeShape) {
        case 'almond':
          ctx.beginPath();
          ctx.ellipse(80, 90, 12, 8, 0, 0, Math.PI * 2);
          ctx.fill();
          ctx.beginPath();
          ctx.ellipse(120, 90, 12, 8, 0, 0, Math.PI * 2);
          ctx.fill();
          break;
        case 'round':
          ctx.beginPath();
          ctx.arc(80, 90, 10, 0, Math.PI * 2);
          ctx.fill();
          ctx.beginPath();
          ctx.arc(120, 90, 10, 0, Math.PI * 2);
          ctx.fill();
          break;
      }
      
      // Draw pupils
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.arc(80, 90, 4, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(120, 90, 4, 0, Math.PI * 2);
      ctx.fill();
      
      // Draw mouth
      ctx.strokeStyle = '#8B0000';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(100, 120, 8, 0, Math.PI, false);
      ctx.stroke();
      
      // Draw outfit indicator
      ctx.fillStyle = getOutfitColor(outfitStyle);
      ctx.fillRect(60, 160, 80, 40);
    }

    function getOutfitColor(style) {
      switch(style) {
        case 'casual': return '#4A90E2';
        case 'elegant': return '#8B0000';
        case 'traditional': return '#DAA520';
        case 'modern': return '#000000';
        default: return '#4A90E2';
      }
    }

    function resetAvatar() {
      const elements = [
        {id: 'skin-color', value: '#F2D3C4'},
        {id: 'hair-style', value: 'long'},
        {id: 'hair-color', value: '#8B4513'},
        {id: 'eye-shape', value: 'almond'},
        {id: 'eye-color', value: '#8B4513'},
        {id: 'outfit-style', value: 'casual'}
      ];
      
      elements.forEach(({id, value}) => {
        const element = document.getElementById(id);
        if (element) element.value = value;
      });
      
      drawAvatar();
    }

    function saveAvatar() {
      const avatarSettings = {
        skinColor: document.getElementById('skin-color')?.value,
        hairStyle: document.getElementById('hair-style')?.value,
        hairColor: document.getElementById('hair-color')?.value,
        eyeShape: document.getElementById('eye-shape')?.value,
        eyeColor: document.getElementById('eye-color')?.value,
        outfitStyle: document.getElementById('outfit-style')?.value
      };
      
      // Store in memory for this session
      window.savedAvatar = avatarSettings;
      alert('Avatar saved successfully!');
    }

    // Payment system
    function showPaymentModal() {
      document.getElementById('payment-modal').style.display = 'flex';
    }

    function hidePaymentModal() {
      document.getElementById('payment-modal').style.display = 'none';
    }

    function selectPricing(option) {
      selectedPricing = option;
      document.querySelectorAll('.pricing-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      event.target.closest('.pricing-option').classList.add('selected');
    }

    function processPurchase() {
      const priceMap = {
        'single': 'price_single_story',
        'all': 'price_all_stories',
        'monthly': 'price_monthly'
      };
      
      // Show loading state
      const button = event.target;
      const originalText = button.textContent;
      button.textContent = 'Processing...';
      button.disabled = true;
      
      // For demo purposes, simulate successful payment
      setTimeout(() => {
        alert('Payment successful! All chapters unlocked.');
        window.premiumUser = true;
        hidePaymentModal();
        button.textContent = originalText;
        button.disabled = false;
      }, 2000);
    }

    function isPremiumUser() {
      return window.premiumUser || false;
    }

    // Progress tracking
    function saveProgress() {
      const progress = {
        currentStory,
        currentChapter,
        timestamp: new Date().toISOString()
      };
      window.userProgress = progress;
    }

    function loadProgress() {
      const progress = window.userProgress;
      if (progress) {
        currentStory = progress.currentStory;
        currentChapter = progress.currentChapter;
      }
    }

    // Voice settings update
    function updateVoiceSettings() {
      if (isReading && currentUtterance) {
        stopReading();
        setTimeout(startReading, 100);
      }
    }

    // Initialize everything when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initializeAvatar();
      loadProgress();
      
      // Add voice setting event listeners
      const voiceElements = ['voice-select', 'voice-speed', 'voice-pitch'];
      voiceElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener('change', updateVoiceSettings);
        }
      });
      
      // Auto-load first story if available
      if (currentStory) {
        loadChapter();
      }
      
      // Add keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'ArrowLeft':
              e.preventDefault();
              previousChapter();
              break;
            case 'ArrowRight':
              e.preventDefault();
              nextChapter();
              break;
            case ' ':
              e.preventDefault();
              toggleTextReader();
              break;
          }
        }
      });
      
      // Save progress when user navigates away
      window.addEventListener('beforeunload', saveProgress);
    });
  </script>
</body>
</html>
